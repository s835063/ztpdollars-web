<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å„ç­å‰6åæ’è¡Œæ¦œ</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #fafafa; }
    .header {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
      gap: 20px;
    }
    h1 { margin: 0; }
    .back-btn {
      padding: 6px 12px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      background: #1976d2;
      color: #fff;
      cursor: pointer;
      transition: background 0.2s;
    }
    .back-btn:hover {
      background: #0d47a1;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }
    .class-card {
      border: 2px solid #ccc;
      border-radius: 10px;
      padding: 10px;
      background: #fff;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
    }
    .class-title {
      font-weight: bold;
      text-align: center;
      margin-bottom: 10px;
      padding: 5px;
      border-radius: 6px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 5px;
      text-align: center;
      font-size: 14px;
    }
    th { background: #eee; }

    /* å‰ä¸‰åç‰¹æ•ˆ */
    .gold   { background: #fff8dc; font-weight: bold; color: #d4af37; }
    .silver { background: #f0f0f0; font-weight: bold; color: #a9a9a9; }
    .bronze { background: #fdf5e6; font-weight: bold; color: #cd7f32; }

    /* HOT æ¨™ç±¤ */
    .hot {
      color: red;
      font-weight: bold;
      margin-left: 5px;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ä¸­å£‡å¹£å„ç­å‰6åæ’è¡Œæ¦œ</h1>
    <button class="back-btn" onclick="location.href='index.html'">è¿”å›é¦–é </button>
  </div>
  <div class="grid" id="classGrid"></div>

  <script>
    const classOrder = [
      "ä¸€å¹´å¿ ç­","äºŒå¹´å¿ ç­","ä¸‰å¹´å¿ ç­","ä¸‰å¹´å­ç­",
      "å››å¹´å¿ ç­","äº”å¹´å¿ ç­","äº”å¹´å­ç­","å…­å¹´å¿ ç­","å…­å¹´å­ç­"
    ];

    const classColors = {
      "ä¸€å¹´å¿ ç­": "#7EB426",
      "äºŒå¹´å¿ ç­": "#f0e055ff",
      "ä¸‰å¹´å¿ ç­": "#FFF3E0",
      "ä¸‰å¹´å­ç­": "#FCE4EC",
      "å››å¹´å¿ ç­": "#f084cfff",
      "äº”å¹´å¿ ç­": "#f3e86aff",
      "äº”å¹´å­ç­": "#66f1d3ff",
      "å…­å¹´å¿ ç­": "#f39d93ff",
      "å…­å¹´å­ç­": "#a27ddaff"
    };

    async function fetchTop6() {
      try {
        const res = await fetch('/api/points');
        const data = await res.json();

        const grouped = {};
        data.forEach(d => {
          if (!grouped[d.class]) grouped[d.class] = {};
          if (!grouped[d.class][d.name]) grouped[d.class][d.name] = 0;
          grouped[d.class][d.name] += d.score;
        });

        const grid = document.getElementById("classGrid");

        // è®€å– localStorage ä¿å­˜çš„ hot æ¨™ç±¤
        let hotData = JSON.parse(localStorage.getItem("hotTop6")) || {};

        classOrder.forEach(cls => {
          const students = Object.entries(grouped[cls] || {})
            .map(([name, score]) => ({name, score}))
            .sort((a,b) => b.score - a.score)
            .slice(0,6);

          const card = document.createElement("div");
          card.className = "class-card";

          let rows = students.map((s, i) => {
            let rowClass = '';
            let medal = '';
            if (i === 0) { rowClass = 'gold'; medal = 'ğŸ¥‡'; }
            else if (i === 1) { rowClass = 'silver'; medal = 'ğŸ¥ˆ'; }
            else if (i === 2) { rowClass = 'bronze'; medal = 'ğŸ¥‰'; }

            const key = `${cls}-${s.name}`;
            const now = Date.now();
            let hotMark = "";

            if (!hotData[key]) {
              // æ–°é€²æ¦œ â†’ æ¨™è¨˜ HOT ä¸¦è¨˜éŒ„æ™‚é–“
              hotData[key] = now;
              hotMark = '<span class="hot">ğŸ”¥HOT</span>';
            } else {
              // æª¢æŸ¥æ˜¯å¦è¶…é 7 å¤©
              const diffDays = (now - hotData[key]) / (1000 * 60 * 60 * 24);
              if (diffDays <= 7) {
                hotMark = '<span class="hot">ğŸ”¥HOT</span>';
              }
            }

            return `
              <tr class="${rowClass}">
                <td>${medal || i+1}</td>
                <td>${s.name} ${hotMark}</td>
                <td>${s.score}</td>
              </tr>
            `;
          }).join("");

          card.innerHTML = `
            <div class="class-title" style="background:${classColors[cls] || '#ddd'}">
              ${cls}
            </div>
            <table>
              <tr><th>åæ¬¡</th><th>å§“å</th><th>ç¸½åˆ†</th></tr>
              ${rows}
            </table>
          `;
          grid.appendChild(card);
        });

        // æ›´æ–° localStorage
        localStorage.setItem("hotTop6", JSON.stringify(hotData));

      } catch (err) {
        console.error("è¼‰å…¥å¤±æ•—", err);
      }
    }

    fetchTop6();
  </script>
</body>
</html>
